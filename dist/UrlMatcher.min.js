/*! agt-dynamicRoutingShared - v0.0.1 - 2013-06-11
 * https://github.com/afterglowtech/agt-dynamicRoutingShared
 * Copyright (c) 2013 Stu Salsbury;
 *    Based on https://github.com/angular-ui/ui-router which is 
 *    Copyright (c) 2013, Karsten Sperling
 * Licensed MIT
 */
define(["common"],function(t){function e(t){this.define(t)}return e.prototype.addParameter=function(t,e,r,i){if(!/^\w+$/.test(t))throw Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(r[t])throw Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");r[t]=!0,i.push(t)},e.prototype.quoteRegExp=function(t){return t.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&")},e.prototype.define=function(e){var r,i=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,n={},s="^",o=0,a=this.segments=[],l=this.params=[];this.source=e;for(var h,p,u;(r=i.exec(e))&&(h=r[2]||r[3],p=r[4]||("*"===r[1]?".*":"[^/]*"),u=e.substring(o,r.index),!(u.indexOf("?")>=0));)s+=this.quoteRegExp(u)+"("+p+")",this.addParameter(h,e,n,l),a.push(u),o=i.lastIndex;u=e.substring(o);var c=u.indexOf("?");if(c>=0){var f=this.sourceSearch=u.substring(c);u=u.substring(0,c),this.sourcePath=e.substring(0,o+c),t.forEach(f.substring(1).split(/[&?]/),function(t){this.addParameter(t,e,n,l)},this)}else this.sourcePath=e,this.sourceSearch="";return s+=this.quoteRegExp(u)+"$",a.push(u),this.regexp=RegExp(s),this.prefix=a[0],this},e.prototype.newInstance=function(t){return new e(t)},e.prototype.concat=function(t){var e=this.newInstance(this.sourcePath+t+this.sourceSearch);return e},e.prototype.toString=function(){return this.source},e.prototype.getParameterValues=function(t,e){var r,i=this.params,n=i.length,s=this.segments.length-1,o={};for(r=0;s>r;r++)o[i[r]]=decodeURIComponent(t[r+1]);for(;n>r;r++)o[i[r]]=e[i[r]];return o},e.prototype.exec=function(t,e){var r=this.regexp.exec(t);return r?this.getParameterValues(r,e):null},e.prototype.parameters=function(){return this.params},e.prototype.format=function(t){var e=this.segments,r=this.params;if(!t)return e.join("");var i,n,s,o=e.length-1,a=r.length,l=e[0];for(i=0;o>i;i++)s=t[r[i]],null!=s&&(l+=s),l+=e[i+1];for(;a>i;i++)s=t[r[i]],null!=s&&(l+=(n?"&":"?")+r[i]+"="+encodeURIComponent(s),n=!0);return l},e.prototype.isMatcher=function(t){return t instanceof e},e});